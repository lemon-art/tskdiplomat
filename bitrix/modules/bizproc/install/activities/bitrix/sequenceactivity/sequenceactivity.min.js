var _SequenceActivityCurClick=null;function _SequenceActivityClick(i,e){_SequenceActivityCurClick.AddActivity(CreateActivity({Properties:{Title:HTMLEncode(arAllActivities[i]["NAME"])},Type:arAllActivities[i]["CLASS"],Children:[]}),e)}SequenceActivity=function(){var i=new BizProcActivity;i.Type="SequenceActivity";i.childsContainer=null;i.iHead=0;i.LineMouseOver=function(i){this.parentNode.style.backgroundImage="url(/bitrix/images/bizproc/arr_over.gif)"};i.LineMouseOut=function(i){this.parentNode.style.backgroundImage="url(/bitrix/images/bizproc/arr.gif)"};i.OnClick=function(e){_SequenceActivityCurClick=i;var t=[];var r;for(r in arAllActGroups){var n=[];for(var l in arAllActivities){if(arAllActivities[l]["EXCLUDED"]||!arAllActivities[l]["CATEGORY"])continue;var o=arAllActivities[l]["CATEGORY"]["ID"];if(arAllActivities[l]["CATEGORY"]["OWN_ID"])o=arAllActivities[l]["CATEGORY"]["OWN_ID"];if(o!=r)continue;if(l=="setstateactivity"&&rootActivity.Type==i.Type)continue;n.push({ICON:"url("+arAllActivities[l]["ICON"]+")",TEXT:'<img src="'+(arAllActivities[l]["ICON"]?arAllActivities[l]["ICON"]:"/bitrix/images/bizproc/act_icon.gif")+'" align="left" style="margin-right: 7px;margin-left: 0px">'+"<b>"+HTMLEncode(arAllActivities[l]["NAME"])+"</b><br>"+HTMLEncode(arAllActivities[l]["DESCRIPTION"]),ONCLICK:"_SequenceActivityClick('"+l+"', "+this.ind+");"})}if(n.length>0)t.push({TEXT:HTMLEncode(arAllActGroups[r]),MENU:n})}if(window.jsPopup_WFAct)window.jsPopup_WFAct.PopupHide();else window.jsPopup_WFAct=new PopupMenu("PopupWFAct",3e4);window.jsPopup_WFAct.ShowMenu(this,t)};i.lastDrop=false;i.ondragging=function(e,t,r){if(!i.childsContainer)return false;for(var n=0;n<=i.childActivities.length;n++){var l=i.childsContainer.rows[n*2+i.iHead].cells[0].childNodes[0];var o=BX.pos(l);if(o.left<t&&t<o.right&&o.top<r&&r<o.bottom){l.onmouseover();i.lastDrop=l;return}}if(i.lastDrop){i.lastDrop.onmouseout();i.lastDrop=false}};i.h1id=DragNDrop.AddHandler("ondragging",i.ondragging);i.ondrop=function(e,t,r){if(!i.childsContainer)return false;if(i.lastDrop){var n;if(DragNDrop.obj.parentActivity){var l,o=-1,c=DragNDrop.obj.parentActivity;for(l=0;l<c.childActivities.length;l++){if(c.childActivities[l].Name==DragNDrop.obj.Name){o=l;break}}if(c.Name!=i.Name||o!=i.lastDrop.ind&&o+1!=i.lastDrop.ind){var a=i,s=false;while(a){if(DragNDrop.obj.Name==a.Name){s=true;break}a=a.parentActivity}if(s){alert(BPMESS["BPSA_ERROR_MOVE"])}else{c.childsContainer.deleteRow(o*2+1+c.iHead);c.childsContainer.deleteRow(o*2+1+c.iHead);for(var d=o;d<c.childActivities.length-1;d++)c.childActivities[d]=c.childActivities[d+1];c.childActivities.pop();for(d=0;d<=c.childActivities.length;d++)c.childsContainer.rows[d*2+c.iHead].cells[0].childNodes[0].ind=d;n=DragNDrop.obj;i.AddActivity(n,i.lastDrop.ind)}}}else{n=CreateActivity(DragNDrop.obj);i.AddActivity(n,i.lastDrop.ind)}i.lastDrop.onmouseout();i.lastDrop=false}};i.h2id=DragNDrop.AddHandler("ondrop",i.ondrop);i.ActivityRemoveChild=i.RemoveChild;i.RemoveChild=function(e){var t,r;for(t=0;t<i.childActivities.length;t++){if(i.childActivities[t].Name==e.Name){if(i.childsContainer){i.childsContainer.rows[t*2+1+i.iHead].cells[0].childNodes[0].onmouseover=null;i.childsContainer.rows[t*2+1+i.iHead].cells[0].childNodes[0].onmouseout=null;i.childsContainer.rows[t*2+1+i.iHead].cells[0].childNodes[0].onclick=null}i.ActivityRemoveChild(e);if(i.childsContainer){i.childsContainer.deleteRow(t*2+1+i.iHead);i.childsContainer.deleteRow(t*2+1+i.iHead);for(r=0;r<=i.childActivities.length;r++)i.childsContainer.rows[r*2+i.iHead].cells[0].childNodes[0].ind=r}break}}};i.RemoveResources=function(e){DragNDrop.RemoveHandler("ondragging",i.h1id);DragNDrop.RemoveHandler("ondrop",i.h2id);if(i.childsContainer&&i.childsContainer.parentNode){i.childsContainer.parentNode.removeChild(i.childsContainer);i.childsContainer=null}};i.AddActivity=function(e,t){var r;for(r=i.childActivities.length;r>t;r--)i.childActivities[r]=i.childActivities[r-1];i.childActivities[t]=e;e.parentActivity=i;var n=i.childsContainer.insertRow(t*2+1+i.iHead).insertCell(-1);n.align="center";n.vAlign="center";e.Draw(n);n=i.childsContainer.insertRow(t*2+2+i.iHead).insertCell(-1);n.align="center";n.vAlign="center";i.CreateLine(t+1);for(r=0;r<=i.childActivities.length;r++)i.childsContainer.rows[r*2+i.iHead].cells[0].childNodes[0].ind=r;BPTemplateIsModified=true};i.CreateLine=function(e){i.childsContainer.rows[e*2+i.iHead].cells[0].style.height="40px";i.childsContainer.rows[e*2+i.iHead].cells[0].style.background="url(/bitrix/images/bizproc/arr.gif) no-repeat scroll 50% 50%";var t=i.childsContainer.rows[e*2+i.iHead].cells[0].appendChild(document.createElement("IMG"));t.src="/bitrix/images/1.gif";t.width="28";t.height="21";t.onmouseover=i.LineMouseOver;t.onmouseout=i.LineMouseOut;t.onclick=i.OnClick;t.ind=e};i.ActivityDraw=i.Draw;i.Draw=function(e){i.childsContainer=e.appendChild(_crt(1+i.childActivities.length*2+i.iHead,1));i.childsContainer.className="seqactivitycontainer";i.childsContainer.id=i.Name;i.CreateLine(0);for(var t in i.childActivities){i.childActivities[t].Draw(i.childsContainer.rows[t*2+1+i.iHead].cells[0]);i.CreateLine(parseInt(t)+1)}if(i.AfterSDraw)i.AfterSDraw()};return i};
//# sourceMappingURL=sequenceactivity.map.js