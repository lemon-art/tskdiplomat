(function(){var e=window.BX;if(e.SocNetLogDestination){return}e.SocNetLogDestination={popupWindow:null,popupSearchWindow:null,containerWindow:null,bByFocusEvent:false,bLoadAllInitialized:false,createSocNetGroupWindow:null,inviteEmailUserWindow:null,inviteEmailUserWindowSubmitted:false,sendEvent:true,extranetUser:false,obUseContainer:{},obShowSearchInput:{},obUserNameTemplate:{},obCurrentElement:{last:null,search:null,group:false},obSearchFirstElement:null,obResult:{last:null,search:null,group:false},obCursorPosition:{last:null,search:null,group:false},obTabs:{},focusOnTabs:false,searchTimeout:null,createSonetGroupTimeout:null,obAllowAddSocNetGroup:{},obAllowAddUser:{},obEmptySearchResult:{},obNewSocNetGroupCnt:{},obDepartmentEnable:{},obSonetgroupsEnable:{},obLastEnable:{},arDialogGroups:{},obWindowClass:{},obWindowCloseIcon:{},obPathToAjax:{},obDepartmentLoad:{},obDepartmentSelectDisable:{},obUserSearchArea:{},obItems:{},obItemsLast:{},obItemsSelected:{},obCallback:{},obElementSearchInput:{},obElementSearchInputHidden:{},obElementBindMainPopup:{},obElementBindSearchPopup:{},obSiteDepartmentID:{},obCrmFeed:{},bFinderInited:false,obClientDb:null,obClientDbData:{},obClientDbDataSearchIndex:{},oDbUserSearchResult:{},oAjaxUserSearchResult:{},obDestSort:{},oSearchWaiterEnabled:{},oSearchWaiterContentHeight:0,obUseClientDatabase:{},bResultMoved:{search:false,last:false,group:false},oXHR:null,obTabSelected:{},obTemplateClass:{1:"bx-finder-box-item",2:"bx-finder-box-item-t2",3:"bx-finder-box-item-t3",4:"bx-finder-box-item-t3",5:"bx-finder-box-item-t5",6:"bx-finder-box-item-t6",7:"bx-finder-box-item-t7","department-user":"bx-finder-company-department-employee-selected",department:"bx-finder-company-department-check-checked"},obTemplateClassSelected:{1:"bx-finder-box-item-selected",2:"bx-finder-box-item-t2-selected",3:"bx-finder-box-item-t3-selected",4:"bx-finder-box-item-t3-selected",5:"bx-finder-box-item-t5-selected",6:"bx-finder-box-item-t6-selected",7:"bx-finder-box-item-t7-selected","department-user":"bx-finder-company-department-employee-selected",department:"bx-finder-company-department-check-checked"}};e.SocNetLogDestination.init=function(t){if(!t.name){t.name="lm"}e.SocNetLogDestination.obPathToAjax[t.name]=!t.pathToAjax?"/bitrix/components/bitrix/main.post.form/post.ajax.php":t.pathToAjax;e.SocNetLogDestination.obShowSearchInput[t.name]=typeof t.showSearchInput!="undefined"&&!!t.showSearchInput;e.SocNetLogDestination.obUseContainer[t.name]=e.SocNetLogDestination.obShowSearchInput[t.name]||typeof t.useContainer!="undefined"&&!!t.useContainer;e.SocNetLogDestination.obUserNameTemplate[t.name]=typeof t.userNameTemplate!="undefined"?t.userNameTemplate:"";e.SocNetLogDestination.obCallback[t.name]=t.callback;e.SocNetLogDestination.obElementBindMainPopup[t.name]=t.bindMainPopup;e.SocNetLogDestination.obElementBindSearchPopup[t.name]=t.bindSearchPopup;e.SocNetLogDestination.obElementSearchInput[t.name]=t.searchInput;e.SocNetLogDestination.obElementSearchInputHidden[t.name]=typeof t.searchInputHidden!="undefined"?t.searchInputHidden:false;e.SocNetLogDestination.obDepartmentSelectDisable[t.name]=t.departmentSelectDisable==true?true:false;e.SocNetLogDestination.obUserSearchArea[t.name]=e.util.in_array(t.userSearchArea,["I","E"])?t.userSearchArea:false;e.SocNetLogDestination.obDepartmentLoad[t.name]={};e.SocNetLogDestination.obWindowClass[t.name]=!t.obWindowClass?"bx-lm-socnet-log-destination":t.obWindowClass;e.SocNetLogDestination.obWindowCloseIcon[t.name]=typeof t.obWindowCloseIcon=="undefined"?true:t.obWindowCloseIcon;e.SocNetLogDestination.extranetUser=t.extranetUser;e.SocNetLogDestination.obCrmFeed[t.name]=t.isCrmFeed;e.SocNetLogDestination.obAllowAddSocNetGroup[t.name]=t.allowAddSocNetGroup===true?true:false;e.SocNetLogDestination.obAllowAddUser[t.name]=t.allowAddUser===true?true:false;e.SocNetLogDestination.obSiteDepartmentID[t.name]=typeof t.siteDepartmentID!="undefined"&&parseInt(t.siteDepartmentID)>0?parseInt(t.siteDepartmentID):false;e.SocNetLogDestination.obNewSocNetGroupCnt[t.name]=0;e.SocNetLogDestination.obLastEnable[t.name]=t.lastTabDisable==true?false:true;e.SocNetLogDestination.obDepartmentEnable[t.name]=false;e.SocNetLogDestination.oDbUserSearchResult[t.name]={};e.SocNetLogDestination.obDestSort[t.name]=typeof t.destSort!="undefined"?t.destSort:[];if(t.items.department){for(var o in t.items.department){e.SocNetLogDestination.obDepartmentEnable[t.name]=true;break}}e.SocNetLogDestination.obSonetgroupsEnable[t.name]=false;if(t.items.sonetgroups){for(var o in t.items.sonetgroups){e.SocNetLogDestination.obSonetgroupsEnable[t.name]=true;break}}e.SocNetLogDestination.obUseClientDatabase[t.name]=true;if(typeof t.useClientDatabase!="undefined"&&t.useClientDatabase===false){e.SocNetLogDestination.obUseClientDatabase[t.name]=false}e.SocNetLogDestination.obTabs[t.name]=[];if(e.SocNetLogDestination.obLastEnable[t.name]){e.SocNetLogDestination.obTabs[t.name].push("last")}if(e.SocNetLogDestination.obSonetgroupsEnable[t.name]){e.SocNetLogDestination.obTabs[t.name].push("group")}if(e.SocNetLogDestination.obDepartmentEnable[t.name]){e.SocNetLogDestination.obTabs[t.name].push("department")}e.SocNetLogDestination.arDialogGroups[t.name]=[];e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:true,groupCode:"contacts",className:"bx-lm-element-contacts",title:e.message("LM_POPUP_TAB_LAST_CONTACTS")});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:true,groupCode:"companies",className:"bx-lm-element-companies",title:e.message("LM_POPUP_TAB_LAST_COMPANIES")});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:true,groupCode:"leads",className:"bx-lm-element-leads",title:e.message("LM_POPUP_TAB_LAST_LEADS")});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:true,groupCode:"deals",className:"bx-lm-element-deals",avatarLessMode:true,title:e.message("LM_POPUP_TAB_LAST_DEALS")});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,groupCode:"groups",bHideGroup:true,className:"bx-lm-element-groups",descLessMode:true});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,groupCode:"users",className:"bx-lm-element-user",descLessMode:true,title:e.message("LM_POPUP_TAB_LAST_USERS")});e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,groupCode:"sonetgroups",className:"bx-lm-element-sonetgroup",classNameExtranetGroup:"bx-lm-element-extranet",groupboxClassName:"bx-lm-groupbox-sonetgroup",descLessMode:true,title:e.message("LM_POPUP_TAB_LAST_SG")});if(e.SocNetLogDestination.obDepartmentEnable[t.name]){e.SocNetLogDestination.arDialogGroups[t.name].push({bCrm:false,groupCode:"department",className:"bx-lm-element-department",groupboxClassName:"bx-lm-groupbox-department",descLessMode:true,title:e.message("LM_POPUP_TAB_LAST_STRUCTURE")})}e.SocNetLogDestination.obItems[t.name]=e.clone(t.items);e.SocNetLogDestination.obItemsLast[t.name]=e.clone(t.itemsLast);e.SocNetLogDestination.obItemsSelected[t.name]=e.clone(t.itemsSelected);for(var n in e.SocNetLogDestination.obItemsSelected[t.name]){var i=e.SocNetLogDestination.obItemsSelected[t.name][n];e.SocNetLogDestination.runSelectCallback(n,i,t.name)}if(e.SocNetLogDestination.obUseClientDatabase[t.name]&&!e.SocNetLogDestination.bFinderInited){e.Finder(false,"destination",[],{});e.onCustomEvent("initFinderDb",[e.SocNetLogDestination,t.name,5]);e.SocNetLogDestination.bFinderInited=true}if(typeof t.LHEObjName!="undefined"&&e("div"+t.LHEObjName)){e.addCustomEvent(e("div"+t.LHEObjName),"OnShowLHE",function(t){if(!t){if(e.SocNetLogDestination.isOpenDialog()){e.SocNetLogDestination.closeDialog()}e.SocNetLogDestination.closeSearch()}})}e.SocNetLogDestination.obTabSelected[t.name]=e.SocNetLogDestination.obLastEnable[t.name]?"last":"";if(!e.SocNetLogDestination.bLoadAllInitialized){e.addCustomEvent("loadAllFinderDb",function(t){e.SocNetLogDestination.loadAll(t)});e.SocNetLogDestination.bLoadAllInitialized=true}};e.SocNetLogDestination.reInit=function(t){for(var o in e.SocNetLogDestination.obItemsSelected[t]){var n=e.SocNetLogDestination.obItemsSelected[t][o];e.SocNetLogDestination.runSelectCallback(o,n,t)}};e.SocNetLogDestination.openContainer=function(t,o){if(!t){t="lm"}if(!o){o={}}if(e.SocNetLogDestination.containerWindow!=null){return false}e.SocNetLogDestination.containerWindow=new e.PopupWindow("BXSocNetLogDestinationContainer",o.bindNode||e.SocNetLogDestination.obElementBindMainPopup[t].node,{autoHide:true,zIndex:1200,offsetLeft:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetLeft),offsetTop:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetTop),bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:e.SocNetLogDestination.obWindowCloseIcon[t]?{top:"4px",right:"13px"}:false,lightShadow:true,events:{onPopupShow:function(){if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]&&e.SocNetLogDestination.obCallback[t].openDialog){e.SocNetLogDestination.obCallback[t].openDialog(t)}if(e.SocNetLogDestination.inviteEmailUserWindow&&e.SocNetLogDestination.inviteEmailUserWindow.isShown()){e.SocNetLogDestination.inviteEmailUserWindow.close()}},onPopupClose:function(e){this.destroy()},onPopupDestroy:e.proxy(function(){e.SocNetLogDestination.containerWindow=null;if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]){if(e.SocNetLogDestination.obCallback[t].closeDialog){e.SocNetLogDestination.obCallback[t].closeDialog(t)}if(e.SocNetLogDestination.obCallback[t].closeSearch){e.SocNetLogDestination.obCallback[t].closeSearch(t)}}},this)},content:!!e.SocNetLogDestination.obShowSearchInput[t]?e.create("DIV",{children:[e.create("DIV",{props:{className:"bx-finder-box bx-lm-box "+e.SocNetLogDestination.obWindowClass[t]},style:{minWidth:"450px",paddingBottom:"8px"},children:[e.create("DIV",{props:{className:"bx-finder-search-block"},children:[e.create("DIV",{props:{className:"bx-finder-search-block-cell"},children:[e.create("SPAN",{attrs:{id:"feed-add-post-destination-item"}}),e.create("SPAN",{attrs:{id:"feed-add-post-destination-input-box",style:"display: inline-block"},props:{className:"feed-add-destination-input-box"},children:[e.create("INPUT",{attrs:{type:"text",id:"feed-add-post-destination-input"},props:{className:"feed-add-destination-inp"}})]})],events:{click:function(o){e.focus(e.SocNetLogDestination.obElementSearchInput[t]);return e.PreventDefault(o)}}})]})]}),e.create("SPAN",{attrs:{id:"BXSocNetLogDestinationContainerContent"}})]}):e.create("SPAN",{attrs:{id:"BXSocNetLogDestinationContainerContent"}})});if(!!e.SocNetLogDestination.obShowSearchInput[t]){e.bind(e("feed-add-post-destination-input"),"keyup",e.delegate(e.SocNetLogDestination.BXfpSearch,{formName:t,inputName:"feed-add-post-destination-input"}));e.bind(e("feed-add-post-destination-input"),"keydown",e.delegate(e.SocNetLogDestination.BXfpSearchBefore,{formName:t,inputName:"feed-add-post-destination-input"}));if(o["itemsHidden"]){for(var n in o["itemsHidden"]){if(o["itemsHidden"].hasOwnProperty(n)){window.BXfpdSelectCallback({id:"SG"+o["itemsHidden"][n]["ID"],name:o["itemsHidden"][n]["NAME"]},"sonetgroups","",true)}}}e.SocNetLogDestination.obElementSearchInput[t]=e("feed-add-post-destination-input");e.defer(e.focus)(e.SocNetLogDestination.obElementSearchInput[t])}return true};e.SocNetLogDestination.getDialogContent=function(t){return e.create("DIV",{style:{minWidth:"450px",paddingBottom:"8px"},props:{className:"bx-finder-box bx-lm-box "+e.SocNetLogDestination.obWindowClass[t]},children:[!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]&&!e.SocNetLogDestination.obDepartmentEnable[t]?null:e.create("DIV",{props:{className:"bx-finder-box-tabs"},children:[e.SocNetLogDestination.obLastEnable[t]?e.create("A",{attrs:{hidefocus:"true",id:"destLastTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-last bx-finder-box-tab-selected"},events:{click:function(){return e.SocNetLogDestination.SwitchTab(t,this,"last")}},html:e.message("LM_POPUP_TAB_LAST")}):null,e.SocNetLogDestination.obSonetgroupsEnable[t]?e.create("A",{attrs:{hidefocus:"true",id:"destGroupTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-sonetgroup"},events:{click:function(){return e.SocNetLogDestination.SwitchTab(t,this,"group")}},html:e.message("LM_POPUP_TAB_SG")}):null,e.SocNetLogDestination.obDepartmentEnable[t]?e.create("A",{attrs:{hidefocus:"true",id:"destDepartmentTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-department"},events:{click:function(){return e.SocNetLogDestination.SwitchTab(t,this,"department")}},html:e.SocNetLogDestination.obUserSearchArea[t]=="E"?e.message("LM_POPUP_TAB_STRUCTURE_EXTRANET"):e.message("LM_POPUP_TAB_STRUCTURE")}):null,e.SocNetLogDestination.obShowSearchInput[t]?e.create("A",{attrs:{hidefocus:"true",id:"destSearchTab_"+t,href:"#switchTab"},props:{className:"bx-finder-box-tab bx-lm-tab-search"},events:{click:function(){return e.SocNetLogDestination.SwitchTab(t,this,"search")}},html:e.message("LM_POPUP_TAB_SEARCH")}):null,e.create("DIV",{props:{className:"popup-window-hr popup-window-buttons-hr"},children:[e.create("I",{})]})]}),e.create("DIV",{attrs:{id:"bx-lm-box-last-content"},props:{className:"bx-finder-box-tabs-content bx-finder-box-tabs-content-window"},children:[e.create("TABLE",{props:{className:"bx-finder-box-tabs-content-table"},children:[e.create("TR",{children:[e.create("TD",{props:{className:"bx-finder-box-tabs-content-cell"},children:[e.SocNetLogDestination.obLastEnable[t]?e.create("DIV",{props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-last"+(e.SocNetLogDestination.obLastEnable[t]?" bx-finder-box-tab-content-selected":"")},html:e.SocNetLogDestination.getItemLastHtml(false,false,t)}):null,e.SocNetLogDestination.obSonetgroupsEnable[t]?e.create("DIV",{attrs:{id:"bx-lm-box-group-content"},props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-sonetgroup"+(!e.SocNetLogDestination.obLastEnable[t]&&e.SocNetLogDestination.obSonetgroupsEnable[t]?" bx-finder-box-tab-content-selected":"")}}):null,e.SocNetLogDestination.obDepartmentEnable[t]?e.create("DIV",{props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-department"+(!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]&&e.SocNetLogDestination.obDepartmentEnable[t]?" bx-finder-box-tab-content-selected":"")}}):null,e.SocNetLogDestination.obShowSearchInput[t]?e.create("DIV",{attrs:{id:"destSearchTabContent_"+t},props:{className:"bx-finder-box-tab-content bx-lm-box-tab-content-search"}}):null]})]})]})]})]})};e.SocNetLogDestination.getSearchContent=function(t,o,n){return e.create("DIV",{props:{className:"bx-finder-box bx-lm-box "+e.SocNetLogDestination.obWindowClass[o]},style:{minWidth:"450px",paddingBottom:"8px"},children:[e.create("DIV",{attrs:{id:"bx-lm-box-search-tabs-content"},props:{className:"bx-finder-box-tabs-content"+(!!e.SocNetLogDestination.obUseContainer[o]?" bx-finder-box-tabs-content-search":"")},children:[e.create("TABLE",{props:{className:"bx-finder-box-tabs-content-table"},children:[e.create("TR",{children:[e.create("TD",{props:{className:"bx-finder-box-tabs-content-cell"},children:[e.create("DIV",{attrs:{id:"bx-lm-box-search-content"},props:{className:"bx-finder-box-tab-content bx-finder-box-tab-content-selected"},html:e.SocNetLogDestination.getItemLastHtml(t,true,o)})]})]})]})]}),e.create("DIV",{attrs:{id:"bx-lm-box-search-waiter"},props:{className:"bx-finder-box-search-waiter"},style:{height:"0px"},children:[e.create("IMG",{props:{className:"bx-finder-box-search-waiter-background"},attrs:{src:"/bitrix/js/main/core/images/waiter-white.gif"}}),e.create("DIV",{props:{className:"bx-finder-box-search-waiter-text"},text:e.message("LM_POPUP_WAITER_TEXT")})]})]})};e.SocNetLogDestination.getHidden=function(t,o){return[e.create("input",{attrs:{type:"hidden",name:"SPERM["+t+"][]",value:o.id}}),t=="UE"&&typeof o.params!="undefined"&&typeof o.params.name!="undefined"?e.create("input",{attrs:{type:"hidden",name:"INVITED_USER_NAME["+o.id+"]",value:o.params.name}}):null,t=="UE"&&typeof o.params!="undefined"&&typeof o.params.lastName!="undefined"?e.create("input",{attrs:{type:"hidden",name:"INVITED_USER_LAST_NAME["+o.id+"]",value:o.params.lastName}}):null]};e.SocNetLogDestination.openDialog=function(t,o){if(!t){t="lm"}if(!o){o={}}if(typeof o.bByFocusEvent!="undefined"&&o.bByFocusEvent){e.SocNetLogDestination.bByFocusEvent=true}if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}if(e.SocNetLogDestination.popupWindow!=null){if(!e.SocNetLogDestination.bByFocusEvent){e.SocNetLogDestination.popupWindow.close()}return false}if(typeof o.bByFocusEvent=="undefined"||!o.bByFocusEvent){e.SocNetLogDestination.bByFocusEvent=false}if(!!e.SocNetLogDestination.obUseContainer[t]){if(!e.SocNetLogDestination.openContainer(t)){return false}e.cleanNode(e("BXSocNetLogDestinationContainerContent"));e("BXSocNetLogDestinationContainerContent").appendChild(e.SocNetLogDestination.getDialogContent(t));if(!!e.SocNetLogDestination.obShowSearchInput[t]){for(var n in e.SocNetLogDestination.obItemsSelected[t]){var i=e.SocNetLogDestination.obItemsSelected[t][n];e.SocNetLogDestination.runSelectCallback(n,i,t)}}e.SocNetLogDestination.containerWindow.setAngle({});e.SocNetLogDestination.containerWindow.show()}else{e.SocNetLogDestination.popupWindow=new e.PopupWindow("BXSocNetLogDestination",o.bindNode||e.SocNetLogDestination.obElementBindMainPopup[t].node,{autoHide:true,zIndex:1200,offsetLeft:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetLeft),offsetTop:parseInt(e.SocNetLogDestination.obElementBindMainPopup[t].offsetTop),bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:e.SocNetLogDestination.obWindowCloseIcon[t]?{top:"12px",right:"15px"}:false,lightShadow:true,events:{onPopupShow:function(){if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]&&e.SocNetLogDestination.obCallback[t].openDialog){e.SocNetLogDestination.obCallback[t].openDialog(t)}if(e.SocNetLogDestination.inviteEmailUserWindow&&e.SocNetLogDestination.inviteEmailUserWindow.isShown()){e.SocNetLogDestination.inviteEmailUserWindow.close()}},onPopupClose:function(e){this.destroy()},onPopupDestroy:e.proxy(function(){e.SocNetLogDestination.popupWindow=null;if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[t]&&e.SocNetLogDestination.obCallback[t].closeDialog){e.SocNetLogDestination.obCallback[t].closeDialog(t)}},this)},content:e.SocNetLogDestination.getDialogContent(t)});e.SocNetLogDestination.popupWindow.setAngle({});e.SocNetLogDestination.popupWindow.show()}if(e.SocNetLogDestination.obLastEnable[t]){e.SocNetLogDestination.initResultNavigation(t,"last",e.SocNetLogDestination.obItemsLast[t]);e.SocNetLogDestination.obTabSelected[t]="last"}if(!e.SocNetLogDestination.obLastEnable[t]&&!e.SocNetLogDestination.obSonetgroupsEnable[t]&&e.SocNetLogDestination.obDepartmentEnable[t]&&e("destDepartmentTab_"+t)){e.SocNetLogDestination.SwitchTab(t,e("destDepartmentTab_"+t),"department")}};e.SocNetLogDestination.search=function(t,o,n,i,a){if(!n)n="lm";if(!a)a={};if(typeof i=="undefined"||i.length<=0){i=e.SocNetLogDestination.obUserNameTemplate[n]}o=o==false?false:true;if(e.SocNetLogDestination.extranetUser){o=false}e.SocNetLogDestination.obSearchFirstElement=null;e.SocNetLogDestination.obCurrentElement.search=null;e.SocNetLogDestination.obResult.search=[];e.SocNetLogDestination.obCursorPosition.search={group:0,row:0,column:0};if(t.length<=0){clearTimeout(e.SocNetLogDestination.searchTimeout);if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}return false}else{var s={groups:{},users:{},sonetgroups:{},department:{},contacts:{},companies:{},leads:{},deals:{}};var r=0;var c=0;var l=0;var d=0;var u=null;var m=false;var S=false;var p=[];var f=false;var b=false;var g=null;var N=[t];var D=null;var L=[];var h=false;if(o){if(e.SocNetLogDestination.oXHR){e.SocNetLogDestination.oXHR.abort()}var v={searchString:t};e.onCustomEvent("findEntityByName",[e.SocNetLogDestination,v,{},e.SocNetLogDestination.oDbUserSearchResult[n]]);if(v.searchString!=t){N.push(v.searchString)}e.SocNetLogDestination.bResultMoved.search=false}else{if(typeof a!="undefined"&&typeof a.textAjax!="undefined"&&a.textAjax!=t){N.push(a.textAjax)}if(!e.SocNetLogDestination.obUserSearchArea[n]){for(var x=0;x<N.length;x++){D=N[x];if(typeof e.SocNetLogDestination.oDbUserSearchResult[n][D]!="undefined"&&e.SocNetLogDestination.oDbUserSearchResult[n][D].length>0){e.onCustomEvent("syncClientDb",[e.SocNetLogDestination,n,e.SocNetLogDestination.oDbUserSearchResult[n][D],typeof e.SocNetLogDestination.oAjaxUserSearchResult[n][D]!="undefined"?e.SocNetLogDestination.oAjaxUserSearchResult[n][D]:{}])}}}}for(var C in s){u=true;L=[];if(e.SocNetLogDestination.obDepartmentSelectDisable[n]&&C=="department"){continue}for(var x=0;x<N.length;x++){D=N[x];if(C=="users"&&o&&typeof e.SocNetLogDestination.oDbUserSearchResult[n][D]!="undefined"&&e.SocNetLogDestination.oDbUserSearchResult[n][D].length>0){for(var y in e.SocNetLogDestination.oDbUserSearchResult[n][D]){if(!e.SocNetLogDestination.obUserSearchArea[n]||e.SocNetLogDestination.obUserSearchArea[n]=="E"&&e.SocNetLogDestination.obClientDbData.users[e.SocNetLogDestination.oDbUserSearchResult[n][D][y]]["isExtranet"]=="Y"||e.SocNetLogDestination.obUserSearchArea[n]=="I"&&e.SocNetLogDestination.obClientDbData.users[e.SocNetLogDestination.oDbUserSearchResult[n][D][y]]["isExtranet"]!="Y"){e.SocNetLogDestination.obItems[n][C][e.SocNetLogDestination.oDbUserSearchResult[n][D][y]]=e.SocNetLogDestination.obClientDbData.users[e.SocNetLogDestination.oDbUserSearchResult[n][D][y]]}}}}for(var y in e.SocNetLogDestination.obItems[n][C]){if(e.SocNetLogDestination.obItemsSelected[n][y]){continue}for(var x=0;x<N.length;x++){f=false;D=N[x];g=D.toLowerCase().split(" ");p=e.SocNetLogDestination.obItems[n][C][y].name.toLowerCase().split(" ");if(typeof e.SocNetLogDestination.obItems[n][C][y].email!="undefined"&&e.SocNetLogDestination.obItems[n][C][y].email.length>0){p.push(e.SocNetLogDestination.obItems[n][C][y].email.toLowerCase())}if(typeof e.SocNetLogDestination.obItems[n][C][y].login!="undefined"&&e.SocNetLogDestination.obItems[n][C][y].login.length>0){p.push(e.SocNetLogDestination.obItems[n][C][y].login.toLowerCase())}if(g.length<=1){for(var I in p){if(p[I].indexOf(D.toLowerCase())===0){f=true;break}else{continue}}}else{f=true;for(var E in g){b=false;for(var I in p){if(p[I].indexOf(g[E])===0){b=true;break}}if(!b){f=false;break}}if(!f){continue}}if(f){break}}if(!f){continue}if(u){if(typeof e.SocNetLogDestination.obResult.search[c]!="undefined"){c++}u=false}h={value:y};if(typeof e.SocNetLogDestination.obDestSort[n][y]!="undefined"){h.sort=e.SocNetLogDestination.obDestSort[n][y]}L.push(h)}L.sort(e.SocNetLogDestination.compareDestinations);for(var x=0;x<L.length;x++){y=L[x].value;s[C][y]=true;S=false;if(e.SocNetLogDestination.obItems[n][C][y]["id"]=="UA"){S=true}else{if(typeof e.SocNetLogDestination.obResult.search[c]=="undefined"){e.SocNetLogDestination.obResult.search[c]=[];l=0;d=0}if(d==2){l++;d=0}if(typeof e.SocNetLogDestination.obResult.search[c][l]=="undefined"){e.SocNetLogDestination.obResult.search[c][l]=[];d=0}}var w=e.clone(e.SocNetLogDestination.obItems[n][C][y]);if(S){m=w}w.type=C;if(!S){if(m){e.SocNetLogDestination.obResult.search[c][l][d]=m;m=false;d++}e.SocNetLogDestination.obResult.search[c][l][d]=w}if(r<=0){e.SocNetLogDestination.obSearchFirstElement=w;e.SocNetLogDestination.obCurrentElement.search=w}r++;d++}}if(o){if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(s,true,n)}else{if(r>0||!!e.SocNetLogDestination.obShowSearchInput[n]){e.SocNetLogDestination.openSearch(s,n,a)}}}else{if(r<=0){if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.destroy()}else if(e.SocNetLogDestination.obShowSearchInput[n]&&e("bx-lm-box-waiter-content-text")){e("bx-lm-box-waiter-content-text").innerHTML=e.message("LM_EMPTY_LIST")}if(e.SocNetLogDestination.obAllowAddSocNetGroup[n]){e.SocNetLogDestination.createSonetGroupTimeout=setTimeout(function(){if(e.SocNetLogDestination.createSocNetGroupWindow===null){e.SocNetLogDestination.createSocNetGroupWindow=new e.PopupWindow("invite-dialog-creategroup-popup",e.SocNetLogDestination.obElementBindSearchPopup[n].node,{offsetTop:1,autoHide:true,content:e.SocNetLogDestination.createSocNetGroupContent(t),zIndex:1200,buttons:e.SocNetLogDestination.createSocNetGroupButtons(t,n)})}else{e.SocNetLogDestination.createSocNetGroupWindow.setContent(e.SocNetLogDestination.createSocNetGroupContent(t));e.SocNetLogDestination.createSocNetGroupWindow.setButtons(e.SocNetLogDestination.createSocNetGroupButtons(t,n))}if(e.SocNetLogDestination.createSocNetGroupWindow.popupContainer.style.display!="block"){e.SocNetLogDestination.createSocNetGroupWindow.show()}},1e3)}}else{if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(s,true,n)}else{e.SocNetLogDestination.openSearch(s,n,a)}}e.SocNetLogDestination.obEmptySearchResult[n]=r<=0}clearTimeout(e.SocNetLogDestination.searchTimeout);if(o&&t.toLowerCase()!=""){e.SocNetLogDestination.showSearchWaiter(n);e.SocNetLogDestination.searchTimeout=setTimeout(function(){e.SocNetLogDestination.oXHR=e.ajax({url:e.SocNetLogDestination.obPathToAjax[n],method:"POST",dataType:"json",data:{LD_SEARCH:"Y",CRM_SEARCH:e.SocNetLogDestination.obCrmFeed[n]?"Y":"N",EXTRANET_SEARCH:e.util.in_array(e.SocNetLogDestination.obUserSearchArea[n],["I","E"])?e.SocNetLogDestination.obUserSearchArea[n]:"N",SEARCH:t.toLowerCase(),SEARCH_CONVERTED:e.message("LANGUAGE_ID")=="ru"&&e.correctText?e.correctText(t.toLowerCase()):"",sessid:e.bitrix_sessid(),nt:typeof i!="undefined"&&i.length>0?i:"",DEPARTMENT_ID:parseInt(e.SocNetLogDestination.obSiteDepartmentID[n])>0?parseInt(e.SocNetLogDestination.obSiteDepartmentID[n]):0,EMAIL_USERS:e.SocNetLogDestination.obAllowAddUser[n]?"Y":"N"},onsuccess:function(o){e.SocNetLogDestination.hideSearchWaiter(n);if(o){var a=typeof o.SEARCH!="undefined"?o.SEARCH:t;var s=e.clone(o);if(Object.keys(s.USERS).length>0){for(var r in s.USERS){if(typeof s.USERS[r].email!="undefined"){delete s.USERS[r]}}}e.onCustomEvent("onFinderAjaxSuccess",[s,e.SocNetLogDestination]);if(!e.SocNetLogDestination.bResultMoved.search){e.SocNetLogDestination.oAjaxUserSearchResult[n]={};e.SocNetLogDestination.oAjaxUserSearchResult[n][a.toLowerCase()]=[];if(Object.keys(o.USERS).length>0){for(var r in o.USERS){f=true;e.SocNetLogDestination.oAjaxUserSearchResult[n][a.toLowerCase()].push(r);e.SocNetLogDestination.obItems[n].users[r]=o.USERS[r]}}else if(e.SocNetLogDestination.obAllowAddUser[n]){var c=e.SocNetLogDestination.checkEmail(t.trim());if(c!==false&&c.email.length>0){e.SocNetLogDestination.openInviteEmailUserDialog(c,n)}}if(e.SocNetLogDestination.obCrmFeed[n]){var l={contacts:"CONTACTS",companies:"COMPANIES",leads:"LEADS",deals:"DEALS"};for(type in l){for(var r in o[l[type]]){f=true;if(!e.SocNetLogDestination.obItems[n][type][r]){e.SocNetLogDestination.obItems[n][type][r]=o[l[type]][r]}}}}e.SocNetLogDestination.search(t,false,n,i,{textAjax:a})}}},onfailure:function(t){e.SocNetLogDestination.hideSearchWaiter(n)}})},1e3)}}};e.SocNetLogDestination.openSearch=function(t,o,n){if(!o){o="lm"}if(!n){n={}}if(e.SocNetLogDestination.popupWindow!=null){e.SocNetLogDestination.popupWindow.close()}if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close();return false}if(!!e.SocNetLogDestination.obUseContainer[o]){var i=false;if(e("bx-lm-box-search-content")){e("bx-lm-box-search-content").innerHTML=e.SocNetLogDestination.getItemLastHtml(t,true,o)}else{i=true;e.cleanNode(e("destSearchTabContent_"+o));e("destSearchTabContent_"+o).appendChild(e.SocNetLogDestination.getSearchContent(t,o,n))}e.SocNetLogDestination.SwitchTab(o,e("destSearchTab_"+o),"search");e.SocNetLogDestination.containerWindow.setAngle({});if(i){e.SocNetLogDestination.oSearchWaiterContentHeight=e.pos(e("bx-lm-box-search-tabs-content")).height}}else{e.SocNetLogDestination.popupSearchWindow=new e.PopupWindow("BXSocNetLogDestinationSearch",n.bindNode||e.SocNetLogDestination.obElementBindSearchPopup[o].node,{autoHide:true,zIndex:1200,offsetLeft:parseInt(e.SocNetLogDestination.obElementBindSearchPopup[o].offsetLeft),offsetTop:parseInt(e.SocNetLogDestination.obElementBindSearchPopup[o].offsetTop),bindOptions:{forceBindPosition:true},closeByEsc:true,closeIcon:e.SocNetLogDestination.obWindowCloseIcon[o]?{top:"12px",right:"15px"}:false,lightShadow:true,events:{onPopupShow:function(){if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[o]&&e.SocNetLogDestination.obCallback[o].openSearch){e.SocNetLogDestination.obCallback[o].openSearch(o)}if(e.SocNetLogDestination.inviteEmailUserWindow&&e.SocNetLogDestination.inviteEmailUserWindow.isShown()){e.SocNetLogDestination.inviteEmailUserWindow.close()}},onPopupClose:function(){this.destroy();if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.obCallback[o]&&e.SocNetLogDestination.obCallback[o].closeSearch){e.SocNetLogDestination.obCallback[o].closeSearch(o)}},onPopupDestroy:e.proxy(function(){e.SocNetLogDestination.popupSearchWindow=null;e.SocNetLogDestination.popupSearchWindowContent=null},this)},content:e.SocNetLogDestination.getSearchContent(t,o,n)});e.SocNetLogDestination.popupSearchWindow.setAngle({});e.SocNetLogDestination.popupSearchWindow.show();e.SocNetLogDestination.oSearchWaiterContentHeight=e.pos(e("bx-lm-box-search-tabs-content")).height}e.SocNetLogDestination.popupSearchWindowContent=e("bx-lm-box-search-content")};e.SocNetLogDestination.drawItemsGroup=function(t,o,n,i,a,s){var r=typeof s.itemsHtml!="undefined"&&s.itemsHtml?s.itemsHtml:"";for(var c in t[o]){if(!e.SocNetLogDestination.obItems[n][o][c]){continue}r+=e.SocNetLogDestination.getHtmlByTemplate7(n,e.SocNetLogDestination.obItems[n][o][c],{className:s.className+(o=="sonetgroup"&&typeof s.classNameExtranetGroup!="undefined"&&typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(e.SocNetLogDestination.obItems[n][o][c].entityId,window["arExtranetGroupID"])?" "+s.classNameExtranetGroup:""),descLessMode:typeof s.descLessMode!="undefined"&&s.descLessMode?true:false,itemType:o,search:i,avatarLessMode:typeof s.avatarLessMode!="undefined"&&s.avatarLessMode?true:false,itemHover:a<=0},i?"search":"last");a++}if(r!=""&&(typeof s.bHideGroup=="undefined"||!s.bHideGroup)){r='<span class="bx-finder-groupbox '+(typeof s.groupboxClassName!="undefined"?s.groupboxClassName:"bx-lm-groupbox-last")+'">'+'<span class="bx-finder-groupbox-name">'+s.title+":</span>"+'<span class="bx-finder-groupbox-content">'+r+"</span>"+"</span>"}return{html:r,count:a}};e.SocNetLogDestination.getItemLastHtml=function(t,o,n){if(!n)n="lm";if(!t){t=e.SocNetLogDestination.obItemsLast[n]}var i="";var a=null;var s=0;var r=null;var c=null;for(var l=0;l<e.SocNetLogDestination.arDialogGroups[n].length;l++){c=e.SocNetLogDestination.arDialogGroups[n][l];if(c.bCrm&&e.SocNetLogDestination.obCrmFeed[n]||!c.bCrm&&(o||!e.SocNetLogDestination.obCrmFeed[n])){r=e.SocNetLogDestination.drawItemsGroup(t,c.groupCode,n,o,s,{itemsHtml:a?a:false,bHideGroup:typeof c.bHideGroup!="undefined"?c.bHideGroup:false,className:typeof c.className!="undefined"?c.className:false,classNameExtranetGroup:typeof c.classNameExtranetGroup!="undefined"?c.classNameExtranetGroup:false,groupboxClassName:typeof c.groupboxClassName!="undefined"?c.groupboxClassName:false,avatarLessMode:typeof c.avatarLessMode!="undefined"?c.avatarLessMode:false,descLessMode:typeof c.descLessMode!="undefined"?c.descLessMode:false,title:typeof c.title!="undefined"?c.title:""});if(r.html.length>0){if(c.bHideGroup!="undefined"&&c.bHideGroup){a=r.html}else{i+=r.html;a=null}}s=r.count}}if(i.length<=0){
i='<span class="bx-finder-groupbox bx-lm-groupbox-search">'+'<span class="bx-finder-groupbox-content" id="bx-lm-box-waiter-content-text">'+e.message(o?"LM_SEARCH_PLEASE_WAIT":"LM_EMPTY_LIST")+"</span>"+"</span>"}return i};e.SocNetLogDestination.getItemGroupHtml=function(t){if(!t)t="lm";var o="";var n=0;for(var i in e.SocNetLogDestination.obItems[t].sonetgroups){o+=e.SocNetLogDestination.getHtmlByTemplate7(t,e.SocNetLogDestination.obItems[t].sonetgroups[i],{className:"bx-lm-element-sonetgroup"+(typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(e.SocNetLogDestination.obItems[t].sonetgroups[i].entityId,window["arExtranetGroupID"])?" bx-lm-element-extranet":""),descLessMode:true,itemType:"sonetgroups",itemHover:n<=0},"group");n++}return o};e.SocNetLogDestination.getItemDepartmentHtml=function(t,o,n,i){if(!t)t="lm";n=n?n:false;i=i?true:false;var a=false;if(typeof o=="undefined"||!o){o=e.SocNetLogDestination.obItems[t].departmentRelation;a=true}var s="";for(var r in o){if(o[r].type=="category"){var c=e.SocNetLogDestination.obItems[t].department[o[r].id];var l=e.SocNetLogDestination.obItemsSelected[t][o[r].id]?e.SocNetLogDestination.obTemplateClassSelected["department"]:"";a=a&&c.id!="EX";s+='<div class="bx-finder-company-department'+(a?" bx-finder-company-department-opened":"")+'">				<a href="#'+c.id+'" class="bx-finder-company-department-inner" onclick="return BX.SocNetLogDestination.OpenCompanyDepartment(\''+t+"', this.parentNode, '"+c.entityId+'\')" hidefocus="true">					<div class="bx-finder-company-department-arrow"></div>					<div class="bx-finder-company-department-text">'+c.name+"</div>				</a>			</div>";s+='<div class="bx-finder-company-department-children'+(a?" bx-finder-company-department-children-opened":"")+'">';if(!e.SocNetLogDestination.obDepartmentSelectDisable[t]&&!a&&c.id!="EX"){s+='<a class="bx-finder-company-department-check '+l+' bx-finder-element" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department', '"+o[r].id+"', 'department')\" rel=\""+o[r].id+'" href="#'+o[r].id+'">';s+='<span class="bx-finder-company-department-check-inner">						<div class="bx-finder-company-department-check-arrow"></div>						<div class="bx-finder-company-department-check-text" rel="'+c.name+": "+e.message("LM_POPUP_CHECK_STRUCTURE")+'">'+e.message("LM_POPUP_CHECK_STRUCTURE")+"</div>					</span>				</a>"}s+=e.SocNetLogDestination.getItemDepartmentHtml(t,o[r].items,c.entityId,a);s+="</div>"}}if(n){s+='<div class="bx-finder-company-department-employees" id="bx-lm-category-relation-'+n+'">';userCount=0;for(var r in o){if(o[r].type=="user"){var d=e.SocNetLogDestination.obItems[t].users[o[r].id];if(d==null){continue}var l=e.SocNetLogDestination.obItemsSelected[t][o[r].id]?e.SocNetLogDestination.obTemplateClassSelected["department-user"]:"";s+='<a href="#'+d.id+'" class="bx-finder-company-department-employee '+l+' bx-finder-element" rel="'+d.id+'" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department-user', '"+d.id+'\', \'users\')" hidefocus="true">					<div class="bx-finder-company-department-employee-info">						<div class="bx-finder-company-department-employee-name">'+d.name+'</div>						<div class="bx-finder-company-department-employee-position">'+d.desc+'</div>					</div>					<div style="'+(d.avatar?"background:url('"+d.avatar+"') no-repeat center center":"")+'" class="bx-finder-company-department-employee-avatar"></div>				</a>';userCount++}}if(userCount<=0){if(!e.SocNetLogDestination.obDepartmentLoad[t][n]){s+='<div class="bx-finder-company-department-employees-loading">'+e.message("LM_PLEASE_WAIT")+"</div>"}if(i){e.SocNetLogDestination.getDepartmentRelation(t,n)}}s+="</div>"}return s};e.SocNetLogDestination.getDepartmentRelation=function(t,o){if(e.SocNetLogDestination.obDepartmentLoad[t][o]){return false}e.ajax({url:e.SocNetLogDestination.obPathToAjax[t],method:"POST",dataType:"json",data:{LD_DEPARTMENT_RELATION:"Y",DEPARTMENT_ID:o,sessid:e.bitrix_sessid(),nt:e.SocNetLogDestination.obUserNameTemplate[t]},onsuccess:function(n){e.SocNetLogDestination.obDepartmentLoad[t][o]=true;var i=e.util.object_search_key(o=="EX"?o:"DR"+o,e.SocNetLogDestination.obItems[t].departmentRelation);html="";for(var a in n.USERS){if(!e.SocNetLogDestination.obItems[t].users[a]){e.SocNetLogDestination.obItems[t].users[a]=n.USERS[a]}if(!i.items[a]){i.items[a]={id:a,type:"user"};var s=e.SocNetLogDestination.obItemsSelected[t][n.USERS[a].id]?e.SocNetLogDestination.obTemplateClassSelected["department-user"]:"";html+='<a href="#'+n.USERS[a].id+'" class="bx-finder-company-department-employee '+s+' bx-finder-element" rel="'+n.USERS[a].id+'" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 'department-user', '"+n.USERS[a].id+'\', \'users\')" hidefocus="true">						<div class="bx-finder-company-department-employee-info">							<div class="bx-finder-company-department-employee-name">'+n.USERS[a].name+'</div>							<div class="bx-finder-company-department-employee-position">'+n.USERS[a].desc+'</div>						</div>						<div style="'+(n.USERS[a].avatar?"background:url('"+n.USERS[a].avatar+"') no-repeat center center":"")+'" class="bx-finder-company-department-employee-avatar"></div>					</a>'}}e("bx-lm-category-relation-"+o).innerHTML=html},onfailure:function(e){}})};e.SocNetLogDestination.getHtmlByTemplate1=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[1]:"";var a=n.itemHover?"bx-finder-box-item-hover":"";var s='<a id="'+t+"_"+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[1]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 1, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" href="#'+o.id+'">		<div class="bx-finder-box-item-text">'+o.name+"</div>	</a>";return s};e.SocNetLogDestination.getHtmlByTemplate2=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[2]:"";var a=n.itemHover?"bx-finder-box-item-t2-hover":"";var s='<a id="'+t+"_"+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[2]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 2, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" href="#'+o.id+'">		<div class="bx-finder-box-item-t2-text">'+o.name+"</div>	</a>";return s};e.SocNetLogDestination.getHtmlByTemplate3=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[3]:"";var a=n.itemHover?"bx-finder-box-item-t3-hover":"";var s='<a id="'+t+"_"+o.id+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 3, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[3]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t3-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center\"":"")+"></div>"+'<div class="bx-finder-box-item-t3-info">'+'<div class="bx-finder-box-item-t3-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t3-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>";return s};e.SocNetLogDestination.getHtmlByTemplate5=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[5]:"";var a=n.itemHover?"bx-finder-box-item-t5-hover":"";var s='<a id="'+t+"_"+o.id+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 5, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[5]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t5-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center\"":"")+"></div>"+'<div class="bx-finder-box-item-t5-info">'+'<div class="bx-finder-box-item-t5-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t5-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>";return s};e.SocNetLogDestination.getHtmlByTemplate6=function(t,o,n){if(!t)t="lm";if(!n)n={};var i=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[6]:"";var a=n.itemHover?"bx-finder-box-item-t6-hover":"";var s='<a id="'+t+"_"+o.id+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 6, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+e.SocNetLogDestination.obTemplateClass[6]+" "+i+" "+a+" bx-finder-element"+(n.className?" "+n.className:"")+'" href="#'+o.id+'">'+'<div class="bx-finder-box-item-t6-avatar" '+(o.avatar?"style=\"background:url('"+o.avatar+"') no-repeat center center\"":"")+"></div>"+'<div class="bx-finder-box-item-t6-info">'+'<div class="bx-finder-box-item-t6-name">'+o.name+"</div>"+(o.desc?'<div class="bx-finder-box-item-t6-desc">'+o.desc+"</div>":"")+"</div>"+'<div class="bx-clear"></div>'+"</a>";return s};e.SocNetLogDestination.getHtmlByTemplate7=function(t,o,n,i){if(!t){t="lm"}if(!n){n={}}if(!i){i=""}var a=e.type.isNotEmptyString(o.desc);a=n.descLessMode&&n.descLessMode==true?false:a;var s=e.SocNetLogDestination.obTemplateClass[7]+" bx-finder-element";s+=e.SocNetLogDestination.obItemsSelected[t][o.id]?" "+e.SocNetLogDestination.obTemplateClassSelected[7]:"";s+=n.itemHover?" bx-finder-box-item-t7-hover":"";s+=a?" bx-finder-box-item-t7-desc-mode":"";s+=n.className?" "+n.className:"";s+=n.avatarLessMode&&n.avatarLessMode==true?" bx-finder-box-item-t7-avatarless":"";if(typeof o.isExtranet!="undefined"&&o.isExtranet=="Y"){s+=" bx-lm-element-extranet"}if(typeof o.isEmail!="undefined"&&o.isEmail=="Y"){s+=" bx-lm-element-email"}s+=typeof(o.isExtranet!="undefined")&&o.isExtranet=="Y"?" bx-lm-element-extranet":"";var r=o.name+(typeof o.showEmail!="undefined"&&o.showEmail=="Y"&&typeof o.email!="undefined"&&o.email.length>0?" ("+o.email+")":"");var c='<a id="'+t+"_"+i+"_"+o.id+'" hidefocus="true" onclick="return BX.SocNetLogDestination.selectItem(\''+t+"', this, 7, '"+o.id+"', '"+(n.itemType?n.itemType:"item")+"', "+(n.search?true:false)+')" rel="'+o.id+'" class="'+s+'" href="#'+o.id+'">'+(o.avatar?'<div class="bx-finder-box-item-t7-avatar"><img bx-lm-item-id="'+o.id+'" bx-lm-item-type="'+n.itemType+'" class="bx-finder-box-item-t7-avatar-img" src="'+o.avatar+"\" onerror=\"BX.onCustomEvent('removeClientDbObject', [BX.SocNetLogDestination, this.getAttribute('bx-lm-item-id'), this.getAttribute('bx-lm-item-type')]); BX.cleanNode(this, true);\"></div>":'<div class="bx-finder-box-item-t7-avatar"></div>')+'<div class="bx-finder-box-item-t7-space"></div>'+'<div class="bx-finder-box-item-t7-info">'+'<div class="bx-finder-box-item-t7-name">'+r+"</div>"+(a?'<div class="bx-finder-box-item-t7-desc">'+o.desc+"</div>":"")+"</div>"+"</a>";return c};e.SocNetLogDestination.SwitchTab=function(t,o,n){var i=e.findChildren(e.findChild(o.parentNode.parentNode,{tagName:"td",className:"bx-finder-box-tabs-content-cell"},true),{tagName:"div"});if(!i){return false}var a=0;var s=e.findChildren(o.parentNode,{tagName:"a"});for(var r=0;r<s.length;r++){if(s[r]===o){e.addClass(s[r],"bx-finder-box-tab-selected");a=r}else{e.removeClass(s[r],"bx-finder-box-tab-selected")}}for(r=0;r<i.length;r++){if(a===r){if(n=="last"){i[r].innerHTML=e.SocNetLogDestination.getItemLastHtml(false,false,t)}else if(n=="group"){i[r].innerHTML=e.SocNetLogDestination.getItemGroupHtml(t)}else if(n=="department"){i[r].innerHTML=e.SocNetLogDestination.getItemDepartmentHtml(t)}e.addClass(i[r],"bx-finder-box-tab-content-selected")}else{e.removeClass(i[r],"bx-finder-box-tab-content-selected")}}e.focus(e.SocNetLogDestination.obElementSearchInput[t]);if(n=="last"){e.SocNetLogDestination.initResultNavigation(t,"last",e.SocNetLogDestination.obItemsLast[t])}else if(n=="group"){e.SocNetLogDestination.initResultNavigation(t,"group",{sonetgroups:e.SocNetLogDestination.obItems[t].sonetgroups})}e.SocNetLogDestination.obTabSelected[t]=n;return false};e.SocNetLogDestination.OpenCompanyDepartment=function(t,o,n){if(!t)t="lm";e.toggleClass(o,"bx-finder-company-department-opened");var i=e.findNextSibling(o,{tagName:"div"});if(e.hasClass(i,"bx-finder-company-department-children"))e.toggleClass(i,"bx-finder-company-department-children-opened");e.SocNetLogDestination.getDepartmentRelation(t,n);return false};Object.size=function(e){var t=0,o;for(o in e){if(e.hasOwnProperty(o))t++}return t};e.SocNetLogDestination.selectItem=function(t,o,n,i,a,s){if(!t){t="lm"}e.focus(e.SocNetLogDestination.obElementSearchInput[t]);if(e.SocNetLogDestination.obItemsSelected[t][i]){return e.SocNetLogDestination.unSelectItem(t,o,n,i,a,s)}e.SocNetLogDestination.obItemsSelected[t][i]=a;if(e.SocNetLogDestination.obItemsLast[t][a]===null){e.SocNetLogDestination.obItemsLast[t][a]=[]}e.SocNetLogDestination.obItemsLast[t][a][i]=i;if(!(o==null||n==null)){e.SocNetLogDestination.changeItemClass(o,n,true)}e.SocNetLogDestination.runSelectCallback(i,a,t,s);if(s===true){if(e.SocNetLogDestination.popupWindow!=null){e.SocNetLogDestination.popupWindow.close()}if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}}else{if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.adjustPosition();if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.adjustPosition()}var r=Object.size(e.SocNetLogDestination.obItemsLast[t][a]);if(r>5){var c={};var l=0;var d=r-5;for(var u in e.SocNetLogDestination.obItemsLast[t][a]){if(l>=d)c[e.SocNetLogDestination.obItemsLast[t][a][u]]=e.SocNetLogDestination.obItemsLast[t][a][u];l++}}else{var c=e.SocNetLogDestination.obItemsLast[t][a]}e.userOptions.save("socialnetwork","log_destination",a,JSON.stringify(c));if(e.util.in_array(a,["contacts","companies","leads","deals"])&&e.SocNetLogDestination.obCrmFeed[t]){var m=[i];for(var u=0;u<e.SocNetLogDestination.obItemsLast[t].crm.length&&m.length<20;u++){if(e.SocNetLogDestination.obItemsLast[t].crm[u]!=i){m.push(e.SocNetLogDestination.obItemsLast[t].crm[u])}}e.SocNetLogDestination.obItemsLast[t].crm=m;e.userOptions.save("crm","log_destination","items",m)}return false};e.SocNetLogDestination.unSelectItem=function(t,o,n,i,a,s){if(!t){t="lm"}if(!e.SocNetLogDestination.obItemsSelected[t][i]){return false}e.SocNetLogDestination.changeItemClass(o,n,false);e.SocNetLogDestination.runUnSelectCallback(i,a,t,s);if(s===true){if(e.SocNetLogDestination.popupWindow!=null){e.SocNetLogDestination.popupWindow.close()}if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}}else{if(e.SocNetLogDestination.popupWindow!=null)e.SocNetLogDestination.popupWindow.adjustPosition();if(e.SocNetLogDestination.popupSearchWindow!=null)e.SocNetLogDestination.popupSearchWindow.adjustPosition()}return false};e.SocNetLogDestination.runSelectCallback=function(t,o,n,i){if(!n){n="lm"}if(!i){i=false}if(e.SocNetLogDestination.obCallback[n]&&e.SocNetLogDestination.obCallback[n].select&&e.SocNetLogDestination.obItems[n][o]&&e.SocNetLogDestination.obItems[n][o][t]){e.SocNetLogDestination.obCallback[n].select(e.SocNetLogDestination.obItems[n][o][t],o,i,false,n)}};e.SocNetLogDestination.runUnSelectCallback=function(t,o,n,i){if(!n)n="lm";if(!i)i=false;delete e.SocNetLogDestination.obItemsSelected[n][t];if(e.SocNetLogDestination.obCallback[n]&&e.SocNetLogDestination.obCallback[n].unSelect&&e.SocNetLogDestination.obItems[n][o]&&e.SocNetLogDestination.obItems[n][o][t]){e.SocNetLogDestination.obCallback[n].unSelect(e.SocNetLogDestination.obItems[n][o][t],o,i,n)}};e.SocNetLogDestination.deleteItem=function(t,o,n){if(!n)n="lm";e.SocNetLogDestination.runUnSelectCallback(t,o,n)};e.SocNetLogDestination.deleteLastItem=function(t){if(!t)t="lm";var o=false;for(var n in e.SocNetLogDestination.obItemsSelected[t])o=n;if(o){var i=e.SocNetLogDestination.obItemsSelected[t][o];e.SocNetLogDestination.runUnSelectCallback(o,i,t)}};e.SocNetLogDestination.initResultNavigation=function(t,o,n){e.SocNetLogDestination.obCurrentElement[o]=null;e.SocNetLogDestination.obResult[o]=[];e.SocNetLogDestination.obCursorPosition[o]={group:0,row:0,column:0};var a=0;var s=null;var r=null;var c=null;var l=-1;var d=0;var u=0;var m=false;var S=null;for(i=0;i<e.SocNetLogDestination.arDialogGroups[t].length;i++){r=e.SocNetLogDestination.arDialogGroups[t][i].groupCode;if(typeof n[r]=="undefined"){continue}if(m){m=false}else{s=0}for(var c in n[r]){if(!e.SocNetLogDestination.obItems[t][r][c]){continue}if(s==0){if(r=="groups"){m=true}l++;e.SocNetLogDestination.obResult[o][l]=[];d=0;u=0}if(u==2){d++;u=0}if(typeof e.SocNetLogDestination.obResult[o][l][d]=="undefined"){e.SocNetLogDestination.obResult[o][l][d]=[]}S={id:c,type:r};e.SocNetLogDestination.obResult[o][l][d][u]=S;if(a<=0){e.SocNetLogDestination.obCurrentElement[o]=S}u++;s++;a++}}};e.SocNetLogDestination.selectFirstSearchItem=function(t){if(!t)t="lm";var o=e.SocNetLogDestination.obSearchFirstElement;if(o!=null){e.SocNetLogDestination.selectItem(t,null,null,o.id,o.type,true);e.SocNetLogDestination.obSearchFirstElement=null}};e.SocNetLogDestination.selectCurrentSearchItem=function(t){e.SocNetLogDestination.selectCurrentItem("search",t)};e.SocNetLogDestination.selectCurrentItem=function(t,o,n){if(e.SocNetLogDestination.popupSearchWindow==null&&e.SocNetLogDestination.popupWindow==null&&e.SocNetLogDestination.containerWindow==null){return}if(!o){o="lm"}if(t=="search"){clearTimeout(e.SocNetLogDestination.searchTimeout);if(e.SocNetLogDestination.oXHR){e.SocNetLogDestination.oXHR.abort()}}var i=e.SocNetLogDestination.obCurrentElement[t];if(i!=null){var a=e(o+"_"+t+"_"+i.id);var s=e.SocNetLogDestination.getTemplateByItemClass(a);e.SocNetLogDestination.selectItem(o,a?a:null,s?s:null,i.id,i.type,i.type==="search");if(typeof n=="undefined"||typeof n.closeDialog=="undefined"||n.closeDialog){e.SocNetLogDestination.obCurrentElement[t]=null;if(e.SocNetLogDestination.isOpenDialog()){e.SocNetLogDestination.closeDialog()}e.SocNetLogDestination.closeSearch()}}};e.SocNetLogDestination.moveCurrentSearchItem=function(t,o){e.SocNetLogDestination.moveCurrentItem("search",t,o)};e.SocNetLogDestination.moveCurrentItem=function(t,o,n){if(e.SocNetLogDestination.popupSearchWindow==null&&e.SocNetLogDestination.popupWindow==null&&e.SocNetLogDestination.containerWindow==null){return}e.SocNetLogDestination.bResultMoved[t]=true;if(t=="search"&&e.SocNetLogDestination.oXHR){e.SocNetLogDestination.oXHR.abort();e.SocNetLogDestination.hideSearchWaiter(o)}if(!e.SocNetLogDestination.obCursorPosition[t]){e.SocNetLogDestination.obCursorPosition[t]={group:0,row:0,column:0}}var i=false;switch(n){case"left":if(e.SocNetLogDestination.focusOnTabs){e.SocNetLogDestination.moveCurrentTab(t,o,n)}else if(e.SocNetLogDestination.obCursorPosition[t].column==1){if(typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row][e.SocNetLogDestination.obCursorPosition[t].column-1]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].column--;i=true}}break;case"right":if(e.SocNetLogDestination.focusOnTabs){e.SocNetLogDestination.moveCurrentTab(t,o,n)}else if(e.SocNetLogDestination.obCursorPosition[t].column==0){if(typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row][e.SocNetLogDestination.obCursorPosition[t].column+1]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].column++;i=true}}break;case"up":if(e.SocNetLogDestination.obCursorPosition[t].row>0&&typeof e.SocNetLogDestination.obResult[t]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row-1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row-1][e.SocNetLogDestination.obCursorPosition[t].column]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].row--;i=true}else if(e.SocNetLogDestination.obCursorPosition[t].row==0&&typeof e.SocNetLogDestination.obResult[t]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1][e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1].length-1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1][e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1].length-1][0]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].row=e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group-1].length-1;e.SocNetLogDestination.obCursorPosition[t].column=0;e.SocNetLogDestination.obCursorPosition[t].group--;i=true}else if(e.SocNetLogDestination.obCursorPosition[t].group==0&&e.SocNetLogDestination.obCursorPosition[t].row==0&&e.util.in_array(t,e.SocNetLogDestination.obTabs[o])){e.SocNetLogDestination.focusOnTabs=true}break;case"down":if(e.SocNetLogDestination.focusOnTabs){e.SocNetLogDestination.focusOnTabs=false}else if(typeof e.SocNetLogDestination.obResult[t]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row+1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row+1][e.SocNetLogDestination.obCursorPosition[t].column]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].row++;i=true}else if(typeof e.SocNetLogDestination.obResult[t]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row+1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row+1][0]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].column=0;e.SocNetLogDestination.obCursorPosition[t].row++;i=true}else if(typeof e.SocNetLogDestination.obResult[t]!="undefined"&&e.SocNetLogDestination.obCursorPosition[t].row==e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group].length-1&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group+1]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group+1][0]!="undefined"&&typeof e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group+1][0][0]!="undefined"){e.SocNetLogDestination.obCursorPosition[t].group++;e.SocNetLogDestination.obCursorPosition[t].row=0;e.SocNetLogDestination.obCursorPosition[t].column=0;i=true}break;default:}if(i){var a=e.SocNetLogDestination.obCurrentElement[t].id;e.SocNetLogDestination.obCurrentElement[t]=e.SocNetLogDestination.obResult[t][e.SocNetLogDestination.obCursorPosition[t].group][e.SocNetLogDestination.obCursorPosition[t].row][e.SocNetLogDestination.obCursorPosition[t].column];if(e(o+"_"+t+"_"+a)){e.SocNetLogDestination.unhoverItem(e(o+"_"+t+"_"+a))}var s=e(o+"_"+t+"_"+e.SocNetLogDestination.obCurrentElement[t].id);var r=null;if(t=="search"){r=e("bx-lm-box-search-tabs-content")}else if(t=="last"){r=e("bx-lm-box-last-content")}else if(t=="group"){r=e("bx-lm-box-group-content")}if(s&&r){var c=e.pos(r);var l=e.pos(s);if(l.bottom>c.bottom||l.top<c.top){r.scrollTop+=l.bottom>c.bottom?l.bottom-c.bottom:l.top-c.top}e.SocNetLogDestination.hoverItem(s)}}};e.SocNetLogDestination.moveCurrentTab=function(t,o,n){var i={last:"destLastTab",group:"destGroupTab",department:"destDepartmentTab"};var a=e.util.array_search(t,e.SocNetLogDestination.obTabs[o]);if(a>=0){if(n=="right"){a++}else if(n=="left"){a--}if(a<=e.SocNetLogDestination.obTabs[o].length-1&&a>=0&&typeof e.SocNetLogDestination.obTabs[o][a]!="undefined"){e.SocNetLogDestination.SwitchTab(o,e(i[e.SocNetLogDestination.obTabs[o][a]]+"_"+o),e.SocNetLogDestination.obTabs[o][a])}}};e.SocNetLogDestination.getItemHoverClassName=function(e){if(!e){return false}if(e.classList.contains("bx-finder-box-item-t1")){return"bx-finder-box-item-t1-hover"}else if(e.classList.contains("bx-finder-box-item-t2")){return"bx-finder-box-item-t2-hover"}else if(e.classList.contains("bx-finder-box-item-t3")){return"bx-finder-box-item-t3-hover"}else if(e.classList.contains("bx-finder-box-item-t4")){return"bx-finder-box-item-t4-hover"}else if(e.classList.contains("bx-finder-box-item-t5")){return"bx-finder-box-item-t5-hover"}else if(e.classList.contains("bx-finder-box-item-t6")){return"bx-finder-box-item-t6-hover"}else if(e.classList.contains("bx-finder-box-item-t7")){return"bx-finder-box-item-t7-hover"}return false};e.SocNetLogDestination.hoverItem=function(t){var o=e.SocNetLogDestination.getItemHoverClassName(t);if(o){e.addClass(t,o)}};e.SocNetLogDestination.unhoverItem=function(t){var o=e.SocNetLogDestination.getItemHoverClassName(t);if(o){e.removeClass(t,o)}};e.SocNetLogDestination.getSelectedCount=function(t){if(!t)t="lm";var o=0;for(var n in e.SocNetLogDestination.obItemsSelected[t])o++;return o};e.SocNetLogDestination.getSelected=function(t){if(!t)t="lm";return e.SocNetLogDestination.obItemsSelected[t]};e.SocNetLogDestination.isOpenDialog=function(){return e.SocNetLogDestination.popupWindow!=null||e.SocNetLogDestination.containerWindow!=null};e.SocNetLogDestination.isOpenSearch=function(){return e.SocNetLogDestination.popupSearchWindow!=null||e.SocNetLogDestination.containerWindow!=null};e.SocNetLogDestination.isOpenContainer=function(){return e.SocNetLogDestination.containerWindow!=null};e.SocNetLogDestination.closeDialog=function(t){t=t===true;if(e.SocNetLogDestination.popupWindow!=null){if(t){e.SocNetLogDestination.popupWindow.destroy()}else{e.SocNetLogDestination.popupWindow.close()}}else if(e.SocNetLogDestination.containerWindow!=null){if(t){e.SocNetLogDestination.containerWindow.destroy()}else{e.SocNetLogDestination.containerWindow.close()}}return true};e.SocNetLogDestination.closeSearch=function(){if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindow.close()}else if(e.SocNetLogDestination.containerWindow!=null){e.SocNetLogDestination.containerWindow.close()}return true};e.SocNetLogDestination.createSocNetGroupContent=function(t){return e.create("div",{children:[e.create("div",{text:e.message("LM_CREATE_SONETGROUP_TITLE").replace("#TITLE#",t)})]})};e.SocNetLogDestination.createSocNetGroupButtons=function(t,o){var n=[new e.PopupWindowButton({text:e.message("LM_CREATE_SONETGROUP_BUTTON_CREATE"),events:{click:function(){var n="SGN"+e.SocNetLogDestination.obNewSocNetGroupCnt[o]+"";e.SocNetLogDestination.obItems[o]["sonetgroups"][n]={id:n,entityId:e.SocNetLogDestination.obNewSocNetGroupCnt[o],name:t,desc:""};var i={sonetgroups:{}};i["sonetgroups"][n]=true;if(e.SocNetLogDestination.popupSearchWindow!=null){e.SocNetLogDestination.popupSearchWindowContent.innerHTML=e.SocNetLogDestination.getItemLastHtml(i,true,o)}else{e.SocNetLogDestination.openSearch(i,o)}e.SocNetLogDestination.obNewSocNetGroupCnt[o]++;e.SocNetLogDestination.createSocNetGroupWindow.close()}}}),new e.PopupWindowButtonLink({text:e.message("LM_CREATE_SONETGROUP_BUTTON_CANCEL"),className:"popup-window-button-link-cancel",events:{click:function(){e.SocNetLogDestination.createSocNetGroupWindow.close()}}})];return n};e.SocNetLogDestination.showSearchWaiter=function(t){if(typeof e.SocNetLogDestination.oSearchWaiterEnabled[t]=="undefined"||!e.SocNetLogDestination.oSearchWaiterEnabled[t]){if(e.SocNetLogDestination.oSearchWaiterContentHeight>0){e.SocNetLogDestination.oSearchWaiterEnabled[t]=true;var o=0;var n=40;e.SocNetLogDestination.animateSearchWaiter(o,n)}}};e.SocNetLogDestination.hideSearchWaiter=function(t){if(typeof e.SocNetLogDestination.oSearchWaiterEnabled[t]!="undefined"&&e.SocNetLogDestination.oSearchWaiterEnabled[t]){e.SocNetLogDestination.oSearchWaiterEnabled[t]=false;var o=40;var n=0;e.SocNetLogDestination.animateSearchWaiter(o,n)}};e.SocNetLogDestination.animateSearchWaiter=function(t,o){if(e("bx-lm-box-search-waiter")&&e("bx-lm-box-search-tabs-content")){new e.fx({time:.5,step:.05,type:"linear",start:t,finish:o,callback:e.delegate(function(t){if(this){this.waiterBlock.style.height=t+"px";this.contentBlock.style.height=e.SocNetLogDestination.oSearchWaiterContentHeight-t+"px"}},{waiterBlock:e("bx-lm-box-search-waiter"),contentBlock:e("bx-lm-box-search-tabs-content")}),callback_complete:function(){}}).start()}};e.SocNetLogDestination.changeItemClass=function(t,o,n){if(t&&typeof e.SocNetLogDestination.obTemplateClassSelected[o]!="undefined"){if(n){e.addClass(t,e.SocNetLogDestination.obTemplateClassSelected[o])}else{e.removeClass(t,e.SocNetLogDestination.obTemplateClassSelected[o])}}};e.SocNetLogDestination.getTemplateByItemClass=function(t){if(t){for(var o in e.SocNetLogDestination.obTemplateClass){if(e.hasClass(t,e.SocNetLogDestination.obTemplateClass[o])){return o;break}}}};e.SocNetLogDestination.BXfpSetLinkName=function(t){if(typeof t.tagInputName!="undefined"&&!!t.tagInputName){e(t.tagInputName).innerHTML=e.SocNetLogDestination.getSelectedCount(t.formName)<=0?t.tagLink1:t.tagLink2}};e.SocNetLogDestination.BXfpSelectCallback=function(t){if(!e.findChild(t.containerInput,{attr:{"data-id":t.item.id}},false,false)){var o=t.type;var n="S";if(e.util.in_array(t.type,["contacts","companies","leads","deals"])){o="crm"}if(t.type=="sonetgroups"){n="SG";if(typeof window["arExtranetGroupID"]!="undefined"&&e.util.in_array(t.item.entityId,window["arExtranetGroupID"])){o="extranet"}}else if(t.type=="groups"){n="UA";o="all-users"}else if(t.type=="users"){n=e.SocNetLogDestination.checkEmail(t.item.id)?"UE":"U";if(typeof t.item.isEmail!="undefined"&&t.item.isEmail=="Y"){o="email"}else if(typeof t.item.isExtranet!="undefined"&&t.item.isExtranet=="Y"){o="extranet"}}else if(t.type=="department"){n="DR"}else if(t.type=="contacts"){n="CRMCONTACT"}else if(t.type=="companies"){n="CRMCOMPANY"}else if(t.type=="leads"){n="CRMLEAD"}else if(t.type=="deals"){n="CRMDEAL"}var i=t.bUndeleted?" feed-add-post-destination-undelete":"";var a=t.item.name+(typeof t.item.showEmail!="undefined"&&t.item.showEmail=="Y"&&typeof t.item.email!="undefined"&&t.item.email.length>0?" ("+t.item.email+")":"");var s=[e.create("span",{props:{className:"feed-add-post-destination-text"},html:a})];var r=e.SocNetLogDestination.getHidden(n,t.item);if(!e.SocNetLogDestination.obShowSearchInput[t.formName]){s=e.util.array_merge(s,r)}var c=e.create("span",{attrs:{"data-id":t.item.id},props:{className:"feed-add-post-destination feed-add-post-destination-"+o+i},children:s});if(!t.bUndeleted){c.appendChild(e.create("span",{props:{className:"feed-add-post-del-but"},events:{click:function(o){e.SocNetLogDestination.deleteItem(t.item.id,t.type,t.formName);e.PreventDefault(o)},mouseover:function(){e.addClass(this.parentNode,"feed-add-post-destination-hover")},mouseout:function(){e.removeClass(this.parentNode,"feed-add-post-destination-hover")}}}))}t.containerInput.appendChild(c)}if(!!e.SocNetLogDestination.obShowSearchInput[t.formName]&&!!e.SocNetLogDestination.obElementSearchInputHidden[t.formName]){if(!e.findChild(e.SocNetLogDestination.obElementSearchInputHidden[t.formName],{attr:{"data-id":t.item.id}
},false,false)){e.SocNetLogDestination.obElementSearchInputHidden[t.formName].appendChild(e.create("span",{attrs:{"data-id":t.item.id},children:r}))}}t.valueInput.value="";e.SocNetLogDestination.BXfpSetLinkName({formName:t.formName,tagInputName:typeof t.tagInputName!="undefined"?t.tagInputName:false,tagLink1:t.tagLink1,tagLink2:t.tagLink2})};e.SocNetLogDestination.BXfpUnSelectCallback=function(t){var o=e.findChildren(e(this.inputContainerName),{attribute:{"data-id":""+t.id+""}},true);if(o!==null){for(var n=0;n<o.length;n++){if(typeof this.undeleteClassName=="undefined"||!e.hasClass(o[n],this.undeleteClassName)){e.remove(o[n])}}}e(this.inputName).value="";e.SocNetLogDestination.BXfpSetLinkName(this);if(!!e.SocNetLogDestination.obShowSearchInput[this.formName]&&!!e.SocNetLogDestination.obElementSearchInputHidden[this.formName]){o=e.findChildren(e.SocNetLogDestination.obElementSearchInputHidden[this.formName],{attribute:{"data-id":""+t.id+""}},true);if(o!==null){for(var n=0;n<o.length;n++){if(typeof this.undeleteClassName=="undefined"||!e.hasClass(o[n],this.undeleteClassName)){e.remove(o[n])}}}}};e.SocNetLogDestination.BXfpSearch=function(t){return e.SocNetLogDestination.searchHandler(t,{formName:this.formName,inputId:this.inputName,linkId:this.tagInputName,sendAjax:true,multiSelect:true})};e.SocNetLogDestination.BXfpSearchBefore=function(t){return e.SocNetLogDestination.searchBeforeHandler(t,{formName:this.formName,inputId:this.inputName})};e.SocNetLogDestination.BXfpOpenDialogCallback=function(){if(typeof this.inputBoxName!="undefined"){e.style(e(this.inputBoxName),"display","inline-block")}if(typeof this.tagInputName!="undefined"){e.style(e(this.tagInputName),"display","none")}e.defer(e.focus)(e(this.inputName))};e.SocNetLogDestination.BXfpCloseDialogCallback=function(){if(!e.SocNetLogDestination.isOpenSearch()&&e(this.inputName).value.length<=0){if(typeof this.inputBoxName!="undefined"){e.style(e(this.inputBoxName),"display","none")}if(typeof this.tagInputName!="undefined"){e.style(e(this.tagInputName),"display","inline-block")}e.SocNetLogDestination.BXfpDisableBackspace()}};e.SocNetLogDestination.BXfpCloseSearchCallback=function(){if(!e.SocNetLogDestination.isOpenSearch()&&e(this.inputName).value.length>0){if(typeof this.inputBoxName!="undefined"){e.style(e(this.inputBoxName),"display","none")}if(typeof this.tagInputName!="undefined"){e.style(e(this.tagInputName),"display","inline-block")}e(this.inputName).value="";e.SocNetLogDestination.BXfpDisableBackspace()}};e.SocNetLogDestination.BXfpDisableBackspace=function(t){if(e.SocNetLogDestination.backspaceDisable||e.SocNetLogDestination.backspaceDisable!==null){e.unbind(window,"keydown",e.SocNetLogDestination.backspaceDisable)}e.bind(window,"keydown",e.SocNetLogDestination.backspaceDisable=function(t){if(t.keyCode==8){e.PreventDefault(t);return false}});setTimeout(function(){e.unbind(window,"keydown",e.SocNetLogDestination.backspaceDisable);e.SocNetLogDestination.backspaceDisable=null},5e3)};e.SocNetLogDestination.searchHandler=function(t,o){if(t.keyCode==16||t.keyCode==17||t.keyCode==18||t.keyCode==20||t.keyCode==244||t.keyCode==224||t.keyCode==91||t.keyCode==9){return false}var n=null;if(e.SocNetLogDestination.popupSearchWindow!=null){n="search"}else if(e.SocNetLogDestination.obTabSelected[o.formName]=="last"||e.SocNetLogDestination.obTabSelected[o.formName]=="group"||e.SocNetLogDestination.obTabSelected[o.formName]=="department"||e.SocNetLogDestination.obTabSelected[o.formName]=="search"){n=e.SocNetLogDestination.obTabSelected[o.formName]}if(n){if(t.keyCode==37){e.SocNetLogDestination.moveCurrentItem(n,o.formName,"left");e.PreventDefault(t);return false}else if(t.keyCode==38){e.SocNetLogDestination.moveCurrentItem(n,o.formName,"up");e.PreventDefault(t);return false}else if(t.keyCode==39){e.SocNetLogDestination.moveCurrentItem(n,o.formName,"right");e.PreventDefault(t);return false}else if(t.keyCode==40){e.SocNetLogDestination.moveCurrentItem(n,o.formName,"down");e.PreventDefault(t);return false}else if(t.keyCode==13){e.SocNetLogDestination.selectCurrentItem(n,o.formName);return e.PreventDefault(t)}else if(typeof o.multiSelect!="undefined"&&o.multiSelect&&t.keyCode==32&&n!="search"){e.SocNetLogDestination.selectCurrentItem(n,o.formName,{closeDialog:false});return true}}if(t.keyCode==27){if(e.SocNetLogDestination.inviteEmailUserWindow==null||!e.SocNetLogDestination.inviteEmailUserWindow.isShown()){e(o.inputId).value="";e.style(e(o.linkId),"display","inline");e.PreventDefault(t)}else{e.SocNetLogDestination.inviteEmailUserWindow.close();return false}}else{e.SocNetLogDestination.search(e(o.inputId).value,o.sendAjax,o.formName)}if(!e.SocNetLogDestination.isOpenDialog()&&e(o.inputId).value.length<=0){e.SocNetLogDestination.openDialog(o.formName)}else{if(e.SocNetLogDestination.sendEvent&&e.SocNetLogDestination.isOpenDialog()&&!e.SocNetLogDestination.isOpenContainer()){e.SocNetLogDestination.closeDialog()}}if(t.keyCode==8){e.SocNetLogDestination.sendEvent=true}return true};e.SocNetLogDestination.searchBeforeHandler=function(t,o){if(t.keyCode==8&&e(o.inputId).value.length<=0){e.SocNetLogDestination.sendEvent=false;e.SocNetLogDestination.deleteLastItem(o.formName)}else if(t.keyCode==13){return e.PreventDefault(t)}return true};e.SocNetLogDestination.loadAll=function(t){if(typeof t!="undefined"&&typeof t.name!="undefined"&&typeof t.callback=="function"){e.ajax({url:"/bitrix/components/bitrix/main.post.form/post.ajax.php",method:"POST",dataType:"json",data:{LD_ALL:"Y",sessid:e.bitrix_sessid()},onsuccess:function(o){e.onCustomEvent("onFinderAjaxLoadAll",[o,e.SocNetLogDestination]);t.callback()},onfailure:function(e){}})}};e.SocNetLogDestination.compareDestinations=function(e,t){if(typeof e.sort=="undefined"&&typeof t.sort=="undefined"){return 0}else if(typeof e.sort!="undefined"&&typeof t.sort=="undefined"){return-1}else if(typeof e.sort=="undefined"&&typeof t.sort!="undefined"){return 1}else{if(typeof e.sort.Y!="undefined"&&typeof t.sort.Y=="undefined"){return-1}else if(typeof e.sort.Y=="undefined"&&typeof t.sort.Y!="undefined"){return 1}else if(typeof e.sort.Y!="undefined"&&typeof t.sort.Y!="undefined"){if(parseInt(e.sort.Y)>parseInt(t.sort.Y)){return-1}else if(parseInt(e.sort.Y)<parseInt(t.sort.Y)){return 1}else{return 0}}else{if(parseInt(e.sort.N)>parseInt(t.sort.N)){return-1}else if(parseInt(e.sort.N)<parseInt(t.sort.N)){return 1}else{return 0}}return 0}return 0};e.SocNetLogDestination.checkEmail=function(e){var t=/^([^<]+)\s<([^>]+)>$/gim;var o=t.exec(e);var n="";var i="";if(o!=null&&o.length==3){n=o[1];var a=n.split(/[\s]+/);i=a.pop();n=a.join(" ");e=o[2].trim()}t=/^[=_0-9a-z+~'!\$&*^`|\#%/?{}-]+(\.[=_0-9a-z+~'!\$&*^`|\#%/?{}-]+)*@(([-0-9a-z_]+\.)+)([a-z0-9-]{2,20})$/gim;if(e.length>=6&&t.test(e)){var s={name:n,lastName:i,email:e.toLowerCase()};return s}else{return false}};e.SocNetLogDestination.openInviteEmailUserDialog=function(t,o){if(e.SocNetLogDestination.inviteEmailUserWindow===null){e.SocNetLogDestination.inviteEmailUserWindow=new e.PopupWindow("invite-email-email-user-popup",e.SocNetLogDestination.obElementSearchInput[o],{offsetTop:1,content:e.SocNetLogDestination.inviteEmailUserContent(t,o),zIndex:1200,lightShadow:true,autoHide:true,closeByEsc:true,angle:{position:"bottom",offset:20},events:{onPopupClose:function(){if(e.SocNetLogDestination.inviteEmailUserWindow!=null||!e.SocNetLogDestination.inviteEmailUserWindow.isShown()){var t={name:e.SocNetLogDestination.inviteEmailUserWindowSubmitted?e("invite_email_user_name").value:"",lastName:e.SocNetLogDestination.inviteEmailUserWindowSubmitted?e("invite_email_user_last_name").value:"",email:e("invite_email_user_email").value};e.SocNetLogDestination.inviteEmailAddUser(o,t)}e.SocNetLogDestination.inviteEmailUserWindowSubmitted=false},onPopupShow:function(){e.defer(e.focus)(e("invite_email_user_name"))}}})}else{e.SocNetLogDestination.inviteEmailUserWindow.setContent(e.SocNetLogDestination.inviteEmailUserContent(t,o))}if(e.SocNetLogDestination.inviteEmailUserWindow.popupContainer.style.display!="block"){e.SocNetLogDestination.inviteEmailUserWindow.show()}};e.SocNetLogDestination.inviteEmailAddUser=function(t,o){var n=false;var i=o.email;var a=e.util.htmlspecialchars(o.name)+(o.name.length>0?" ":"")+e.util.htmlspecialchars(o.lastName);if(a.length<=0){a=i}else{n=true}if(typeof e.SocNetLogDestination.obItems[t]["users"]=="undefined"){e.SocNetLogDestination.obItems[t]["users"]=[]}e.SocNetLogDestination.obItems[t]["users"][i]={name:a,email:i,id:i,isEmail:"Y",showEmail:n?"Y":"N",params:o};e.SocNetLogDestination.runSelectCallback(i,"users",t)};e.SocNetLogDestination.inviteEmailUserContent=function(t,o){return e.create("DIV",{props:{className:"bx-feed-email-popup"},children:[e.create("DIV",{props:{className:"bx-feed-email-title"},text:e.message("LM_INVITE_EMAIL_USER_TITLE")}),e.create("FORM",{style:{padding:0,margin:0},events:{submit:function(t){e.SocNetLogDestination.inviteEmailUserSubmitForm(o);e.PreventDefault(t)}},children:[e.create("INPUT",{attrs:{id:"invite_email_user_email",type:"hidden",value:t.email}}),e.create("INPUT",{attrs:{id:"invite_email_user_name",type:"text",placeholder:e.message("LM_INVITE_EMAIL_USER_PLACEHOLDER_NAME"),value:t.name},props:{className:"bx-feed-email-input"}}),e.create("INPUT",{attrs:{id:"invite_email_user_last_name",type:"text",placeholder:e.message("LM_INVITE_EMAIL_USER_PLACEHOLDER_LAST_NAME"),value:t.lastName},props:{className:"bx-feed-email-input"},events:{keyup:function(t){if(e("invite_email_user_name").value.length>0||e("invite_email_user_last_name").value.length>0){e.removeClass(e("invite_email_user_button"),"webform-button-disable")}else{e.addClass(e("invite_email_user_button"),"webform-button-disable")}e.PreventDefault(t)}}}),e.create("SPAN",{attrs:{id:"invite_email_user_button"},props:{className:"webform-small-button webform-small-button-blue webform-button-disable"},text:e.message("LM_INVITE_EMAIL_USER_BUTTON_OK"),style:{cursor:"pointer"},events:{click:function(){e.SocNetLogDestination.inviteEmailUserSubmitForm(o)}}}),e.create("INPUT",{style:{display:"none"},attrs:{type:"submit"}})]})]})};e.SocNetLogDestination.inviteEmailUserSubmitForm=function(t){e.SocNetLogDestination.inviteEmailUserWindowSubmitted=true;e.SocNetLogDestination.inviteEmailUserWindow.close()}})();
//# sourceMappingURL=log-destination.map.js